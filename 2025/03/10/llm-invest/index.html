<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#020261"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#020261">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.23.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="LLM empowered InvestmentsIn this article I introduce a way to use LLMs like the QwQ-32B model to create a sector rotation strategy which is able to outperform an index.  Why LLMs - new capability can">
<meta property="og:type" content="article">
<meta property="og:title" content="LLM for investment">
<meta property="og:url" content="http://example.com/2025/03/10/llm-invest/index.html">
<meta property="og:site_name" content="Efficient Corner">
<meta property="og:description" content="LLM empowered InvestmentsIn this article I introduce a way to use LLMs like the QwQ-32B model to create a sector rotation strategy which is able to outperform an index.  Why LLMs - new capability can">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/llm_1.png">
<meta property="article:published_time" content="2025-03-10T02:16:16.000Z">
<meta property="article:modified_time" content="2025-04-04T03:02:26.609Z">
<meta property="article:author" content="Andy Cai">
<meta property="article:tag" content="Machine Learning">
<meta property="article:tag" content="Data Science">
<meta property="article:tag" content="LLM">
<meta property="article:tag" content="Investments">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/llm_1.png">


<link rel="canonical" href="http://example.com/2025/03/10/llm-invest/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://example.com/2025/03/10/llm-invest/","path":"2025/03/10/llm-invest/","title":"LLM for investment"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>LLM for investment | Efficient Corner</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.36/fancybox/fancybox.umd.js" integrity="sha256-hiUEBwFEpLF6DlB8sGXlKo4kPZ46Ui4qGpd0vrVkOm4=" crossorigin="anonymous" defer></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  



  <script src="/js/third-party/fancybox.js" defer></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Efficient Corner</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Condensation of experiences</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-photos"><a href="/photos/" rel="section"><i class="fa fa-camera fa-fw"></i>photos</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#LLM-empowered-Investments"><span class="nav-number">1.</span> <span class="nav-text">LLM empowered Investments</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Why-LLMs-new-capability-can-capture-new-inefficiencies"><span class="nav-number">1.1.</span> <span class="nav-text">Why LLMs - new capability can capture new inefficiencies.</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Model-and-Deployment"><span class="nav-number">1.2.</span> <span class="nav-text">Model and Deployment</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#LLM-for-investment-workflow"><span class="nav-number">2.</span> <span class="nav-text">LLM for investment workflow</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Data-Preparation-Ingestion"><span class="nav-number">2.1.</span> <span class="nav-text">1. Data Preparation &amp; Ingestion</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-News-Text-Preprocessing"><span class="nav-number">2.1.1.</span> <span class="nav-text">1.1 News Text Preprocessing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-Stock-Data-Preparation"><span class="nav-number">2.1.2.</span> <span class="nav-text">1.2 Stock Data Preparation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Entity-Extraction-RAG-Setup"><span class="nav-number">2.2.</span> <span class="nav-text">2. Entity Extraction &amp; RAG Setup</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-Sector-Company-Recognition"><span class="nav-number">2.2.1.</span> <span class="nav-text">2.1 Sector&#x2F;Company Recognition</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-Stock-Data-Retrieval-RAG"><span class="nav-number">2.2.2.</span> <span class="nav-text">2.2 Stock Data Retrieval (RAG)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Sentiment-Impact-Analysis"><span class="nav-number">2.3.</span> <span class="nav-text">3. Sentiment &amp; Impact Analysis</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Aggregation-Ranking"><span class="nav-number">2.4.</span> <span class="nav-text">4. Aggregation &amp; Ranking</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-Sector-Score-Calculation"><span class="nav-number">2.4.1.</span> <span class="nav-text">4.1 Sector Score Calculation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-Final-Ranking-LLM"><span class="nav-number">2.4.2.</span> <span class="nav-text">4.2 Final Ranking LLM</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Andy Cai</p>
  <div class="site-description" itemprop="description">A quantitative portfolio manager passionate about dissecting complexity at the intersection of finance, math, and technology. This site is my digital lab—a space where I document technical deep dives, code snippets, and analytical explorations into algorithmic trading, risk modeling, data science, and the occasional offbeat problem that sparks my curiosity.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">16</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ajc327" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ajc327" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:andycai517@gmail.com" title="E-Mail → mailto:andycai517@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/03/10/llm-invest/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Andy Cai">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Efficient Corner">
      <meta itemprop="description" content="A quantitative portfolio manager passionate about dissecting complexity at the intersection of finance, math, and technology. This site is my digital lab—a space where I document technical deep dives, code snippets, and analytical explorations into algorithmic trading, risk modeling, data science, and the occasional offbeat problem that sparks my curiosity.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="LLM for investment | Efficient Corner">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          LLM for investment
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-03-10 10:16:16" itemprop="dateCreated datePublished" datetime="2025-03-10T10:16:16+08:00">2025-03-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-04-04 11:02:26" itemprop="dateModified" datetime="2025-04-04T11:02:26+08:00">2025-04-04</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="LLM-empowered-Investments"><a href="#LLM-empowered-Investments" class="headerlink" title="LLM empowered Investments"></a>LLM empowered Investments</h1><p>In this article I introduce a way to use LLMs like the QwQ-32B model to create a sector rotation strategy which is able to outperform an index. </p>
<h2 id="Why-LLMs-new-capability-can-capture-new-inefficiencies"><a href="#Why-LLMs-new-capability-can-capture-new-inefficiencies" class="headerlink" title="Why LLMs - new capability can capture new inefficiencies."></a>Why LLMs - new capability can capture new inefficiencies.</h2><p>LLMs like GPT4 and Deepseek are transforming every industry. Its unique ability to process large amount of texual information systematically is especially useful for quantitative hedge funds, who often formulate their strategies on their ability to process large amount of data quickly and making the most informed decision based on the comprehensive insights generated.  LLMs is useful in many tasks in the quantitative field, from day-to-day tasks like writing code to strategy development, when combined with alternative data such as meeting minutes and reports.</p>
<h2 id="Model-and-Deployment"><a href="#Model-and-Deployment" class="headerlink" title="Model and Deployment"></a>Model and Deployment</h2><ul>
<li>Model: <code>QwQ-32B</code> </li>
<li>GPU: <code>4 x Nvidia A100 40G</code> </li>
<li>Inference solution: <code>Vllm Server</code> </li>
<li>Input Data: <code>news, meeting minutes, reports</code>, about 150 pieces a day.</li>
</ul>
<h1 id="LLM-for-investment-workflow"><a href="#LLM-for-investment-workflow" class="headerlink" title="LLM for investment workflow"></a>LLM for investment workflow</h1><h2 id="1-Data-Preparation-Ingestion"><a href="#1-Data-Preparation-Ingestion" class="headerlink" title="1. Data Preparation &amp; Ingestion"></a>1. Data Preparation &amp; Ingestion</h2><h3 id="1-1-News-Text-Preprocessing"><a href="#1-1-News-Text-Preprocessing" class="headerlink" title="1.1 News Text Preprocessing"></a>1.1 News Text Preprocessing</h3><p>Input: Raw news texts (t₁, t₂, …, tₙ).<br><img data-src="/images/llm_1.png" alt="News data from financial terminal">  </p>
<ul>
<li>Steps:<ul>
<li>Clean text (remove HTML, special characters).</li>
<li>Split into individual articles (if not already separated).</li>
<li>Store in a structured format (e.g., JSON) with metadata (date, source).</li>
</ul>
</li>
</ul>
<h3 id="1-2-Stock-Data-Preparation"><a href="#1-2-Stock-Data-Preparation" class="headerlink" title="1.2 Stock Data Preparation"></a>1.2 Stock Data Preparation</h3><p>Data Types:</p>
<ul>
<li>Fundamentals: P&#x2F;E ratios, revenue growth, debt-to-equity.</li>
<li>Price Data: Daily returns, volatility, moving averages.</li>
<li>Sector Metadata: Predefined sector classifications (e.g., GICS sectors).</li>
</ul>
<p>Storage:</p>
<ul>
<li>Use a local SQL database for structured data.</li>
<li>Embed fundamentals&#x2F;textual data into vectors using a local embedding model (e.g., SentenceTransformers).</li>
</ul>
<h2 id="2-Entity-Extraction-RAG-Setup"><a href="#2-Entity-Extraction-RAG-Setup" class="headerlink" title="2. Entity Extraction &amp; RAG Setup"></a>2. Entity Extraction &amp; RAG Setup</h2><h3 id="2-1-Sector-Company-Recognition"><a href="#2-1-Sector-Company-Recognition" class="headerlink" title="2.1 Sector&#x2F;Company Recognition"></a>2.1 Sector&#x2F;Company Recognition</h3><p>Agent 1: Entity Extraction LLM</p>
<p>Prompt:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Identify all companies and their associated sectors mentioned in the text below. Return output as JSON:</span><br><span class="line">&#123;</span><br><span class="line">  &quot;companies&quot;: [&#123;&quot;name&quot;: &quot;Apple&quot;, &quot;sector&quot;: &quot;酒&quot;&#125;],</span><br><span class="line">  &quot;sectors&quot;: [&quot;Consumer&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Output: Structured sector&#x2F;company data per news text.</p>
<h3 id="2-2-Stock-Data-Retrieval-RAG"><a href="#2-2-Stock-Data-Retrieval-RAG" class="headerlink" title="2.2 Stock Data Retrieval (RAG)"></a>2.2 Stock Data Retrieval (RAG)</h3><ul>
<li><p>Vector Database: FAISS&#x2F;Chroma with embeddings of:</p>
<ul>
<li>Company names + sector metadata.</li>
<li>Key fundamentals (e.g., “Apple P&#x2F;E: 28.5, Revenue Growth: 8%” as text).</li>
</ul>
</li>
<li><p>Retrieval:</p>
<ul>
<li>For each identified company&#x2F;sector, retrieve relevant:</li>
<li>Fundamentals (P&#x2F;E, growth rates).</li>
<li>Recent price trends (e.g., 30-day return).</li>
</ul>
</li>
<li><p>Example retrieved context for a news article about Apple:</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[Apple Inc. Fundamentals]</span><br><span class="line">- P/E Ratio: 28.5 (vs. sector avg: 25.3)</span><br><span class="line">- Revenue Growth (YoY): +8%</span><br><span class="line">- 30-Day Price Change: +12.3%</span><br></pre></td></tr></table></figure>

<h2 id="3-Sentiment-Impact-Analysis"><a href="#3-Sentiment-Impact-Analysis" class="headerlink" title="3. Sentiment &amp; Impact Analysis"></a>3. Sentiment &amp; Impact Analysis</h2><p>Agent 2: News Scoring LLM</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Prompt:</span><br><span class="line">Analyze the news text below and contextual stock data. For each sector, provide:</span><br><span class="line">1. Sentiment (-5 to +5).</span><br><span class="line">2. Impact Magnitude (Low/Medium/High).</span><br><span class="line">3. Rationale (1-2 sentences).</span><br><span class="line"></span><br><span class="line">News Text: &#123;text&#125;</span><br><span class="line">Contextual Data: &#123;retrieved_stock_data&#125;</span><br></pre></td></tr></table></figure>

<p>Output (per text):</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;sectors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;sector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Information Technology&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sentiment&quot;</span><span class="punctuation">:</span> <span class="number">4.2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;impact&quot;</span><span class="punctuation">:</span> <span class="string">&quot;High&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;rationale&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Positive sentiment due to Apple&#x27;s new product launch...&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-Aggregation-Ranking"><a href="#4-Aggregation-Ranking" class="headerlink" title="4. Aggregation &amp; Ranking"></a>4. Aggregation &amp; Ranking</h2><h3 id="4-1-Sector-Score-Calculation"><a href="#4-1-Sector-Score-Calculation" class="headerlink" title="4.1 Sector Score Calculation"></a>4.1 Sector Score Calculation</h3><ul>
<li>Aggregate Metrics:<ul>
<li>Average sentiment score per sector.</li>
<li>Weighted impact (e.g., High&#x3D;3, Medium&#x3D;2, Low&#x3D;1).</li>
<li>Recent price momentum (from stock data).</li>
<li>Fundamental score (e.g., P&#x2F;E percentile vs. sector).</li>
</ul>
</li>
</ul>
<h3 id="4-2-Final-Ranking-LLM"><a href="#4-2-Final-Ranking-LLM" class="headerlink" title="4.2 Final Ranking LLM"></a>4.2 Final Ranking LLM</h3><p>Agent 3: Sector Ranking LLM</p>
<ul>
<li>Input:<ul>
<li>Aggregated sector scores.</li>
<li>Sector fundamentals (avg P&#x2F;E, growth).</li>
<li>Price momentum trends.</li>
</ul>
</li>
</ul>
<p>Prompt:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Rank sectors for investment based on the following criteria:</span><br><span class="line">1. News Sentiment (weight: 40%)</span><br><span class="line">2. Price Momentum (weight: 30%)</span><br><span class="line">3. Fundamentals (weight: 30%)</span><br><span class="line"></span><br><span class="line">Data:</span><br><span class="line">- Information Technology: </span><br><span class="line">  Avg Sentiment: +4.1, Momentum: +12%, P/E: 25.3</span><br><span class="line">- Healthcare: </span><br><span class="line">  Avg Sentiment: +2.8, Momentum: +5%, P/E: 20.1</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;rankings&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;sector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Information Technology&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;rationale&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Strong product cycles...&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;sector&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Healthcare&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;rationale&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Undervalued despite...&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>Implementation Tools</li>
</ol>
<ul>
<li><p>LLM Orchestration:</p>
<ul>
<li>LlamaIndex for RAG pipelines.</li>
<li>LangChain for agent workflows.</li>
</ul>
</li>
<li><p>Data Storage:</p>
<ul>
<li>SQLite for structured stock data.</li>
</ul>
</li>
</ul>
<ol start="6">
<li>Workflow Automation<br>Using python, we can link all of this together and complete our LLM sector rotation framework. Here is some Pseudocode.</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index <span class="keyword">import</span> VectorStoreIndex, SQLDatabase</span><br><span class="line"><span class="keyword">from</span> langchain_community.llms <span class="keyword">import</span> LlamaCpp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. Load data</span></span><br><span class="line">news_texts = load_news()</span><br><span class="line">db = SQLDatabase(<span class="string">&quot;stocks.db&quot;</span>)</span><br><span class="line">vector_index = VectorStoreIndex.load(<span class="string">&quot;sector_vectors&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. Process each news text</span></span><br><span class="line">results = []</span><br><span class="line"><span class="keyword">for</span> text <span class="keyword">in</span> news_texts:</span><br><span class="line">    <span class="comment"># Extract entities</span></span><br><span class="line">    entities = llm_entity_extract(text)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Retrieve relevant data</span></span><br><span class="line">    context = vector_index.retrieve(entities[<span class="string">&quot;companies&quot;</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Analyze sentiment</span></span><br><span class="line">    analysis = llm_analyze(text, context)</span><br><span class="line">    results.append(analysis)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. Aggregate scores</span></span><br><span class="line">sector_scores = calculate_aggregates(results)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. Generate rankings</span></span><br><span class="line">fundamentals = db.query(<span class="string">&quot;SELECT sector, pe_ratio FROM fundamentals&quot;</span>)</span><br><span class="line">ranking = llm_rank(sector_scores, fundamentals)</span><br></pre></td></tr></table></figure>






    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Machine-Learning/" rel="tag"># Machine Learning</a>
              <a href="/tags/Data-Science/" rel="tag"># Data Science</a>
              <a href="/tags/LLM/" rel="tag"># LLM</a>
              <a href="/tags/Investments/" rel="tag"># Investments</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/03/02/institutional-clients/" rel="prev" title="Institutional client relations">
                  <i class="fa fa-angle-left"></i> Institutional client relations
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/04/04/time-moe-invest/" rel="next" title="Time-MoE(Mixture of Experts) for Finance">
                  Time-MoE(Mixture of Experts) for Finance <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Andy Cai</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/ajc327" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
